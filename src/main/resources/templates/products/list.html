<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Danh sách sản phẩm</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=shopping_cart" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link rel="icon" href="image/lyn_acc.avif">
    <link href="https://fonts.googleapis.com/css2?family=Bowlby+One+SC&family=Fleur+De+Leah&family=Nosifer&family=Mystery+Quest&family=Rubik+Moonrocks&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" th:href="@{/css/style.css}">
    
    <style>
        .container {
            margin-top: 70px;
        }
        /* --- Product Grid Container --- */
        .product-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 24px; /* Khoảng cách giữa các card */
            justify-content: center; /* Căn giữa các card nếu hàng cuối không đầy */
            margin-top: 20px;
        }

        /* --- Product Card --- */
        .product-card {
            width: 300px; /* Chiều rộng cố định cho mỗi card */
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column; /* Xếp nội dung theo chiều dọc */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        /* --- Nội dung card --- */
        .product-card-content {
            padding: 20px;
            flex-grow: 1; /* Giúp đẩy phần actions xuống dưới cùng */
            display: flex;
            flex-direction: column;
        }

        .product-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 1.15rem;
            font-weight: bold;
            color: rgb(219, 47, 47); /* Màu xanh giống nút */
            margin-bottom: 12px;
        }

        .product-description {
            font-size: 0.9rem;
            color: #555;
            flex-grow: 1; /* Đảm bảo mô tả lấp đầy không gian */
            margin-bottom: 15px;
            /* Giới hạn số dòng hiển thị (tùy chọn) */
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 4; /* Hiển thị tối đa 3 dòng */
            -webkit-box-orient: vertical;
        }

        .product-category {
            font-size: 0.85rem;
            color: #777;
            background-color: #f8f9fa;
            padding: 4px 8px;
            border-radius: 5px;
            align-self: flex-start; /* Nằm ở đầu */
        }

        /* --- Khu vực nút bấm --- */
        .product-card-actions {
            padding: 15px 20px;
            border-top: 1px solid #f0f0f0;
            background-color: #fcfcfc;
            text-align: right; /* Căn các nút sang phải */
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
        }
        
        .product-card-actions .btn {
            margin-left: 8px; /* Khoảng cách giữa các nút */
            text-decoration: none;
        }
        
        /* --- Thông báo không có sản phẩm --- */
        .no-products-message {
            width: 100%;
            text-align: center;
            color: gray;
            font-size: 1.1rem;
            padding: 40px 0;
        }
        /* --- Search & Filter Box --- */
        .search-box {
        text-align: center;
        margin: 40px auto 20px;
        padding: 20px;
        background: linear-gradient(135deg, #ffffff, #f2f6ff);
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        width: 90%;
        max-width: 900px;
        }

        .filter-search-form {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
        }
        /* --- Select, Input, Button --- */
        .filter-search-form select,
        .filter-search-form input {
            padding: 10px 14px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
            outline: none;
            transition: all 0.3s ease;
            background-color: #fff;
            min-width: 200px;
        }

        .filter-search-form select:hover,
        .filter-search-form input:focus {
            border-color: #2c7a7b;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.4);
        }

        /* --- Buttons --- */
        .filter-search-form .btn {
        background-color: #2c7a7b;
        color: #fff;
        border: none;
        padding: 10px 16px;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s ease, transform 0.2s ease;
        }

        .filter-search-form .btn:hover {
        background-color: #285e61;
        transform: scale(1.05);
        }

        .filter-search-form .btn:nth-child(4) { /* nút Reset */
            background-color: #6c757d;
            text-decoration: none;
        }

        .filter-search-form .btn:nth-child(4):hover {
        background-color: #555;
        }

        /* --- Pagination --- */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 40px auto;
            gap: 8px;
            flex-wrap: wrap;
        }

        .pagination a {
            color: #2c7a7b;
            background-color: #ffffff;
            border: 1px solid #2c7a7b;
            padding: 10px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 40px;
            text-align: center;
        }

        .pagination a:hover {
            background-color: #2c7a7b;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .pagination a.active {
            background-color: #2c7a7b;
            color: #fff;
            border-color: #2c7a7b;
            font-weight: bold;
            cursor: default;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .pagination a {
                padding: 8px 12px;
                font-size: 14px;
            }
        }

    </style>
</head>

<body>
    <div th:replace="~{fragments/_header :: header}"></div>
    <video width="100%" height="695px" controls autoplay muted>
        <source src="image/banner/video_product.mp4" type="video/mp4">
    </video>


<div class="container">

    <div class="search-box">
        <form th:action="@{/products}" method="get" class="filter-search-form">

            <select name="categoryId" onchange="this.form.submit()">
                <option value="">-- Lọc theo danh mục --</option>
                <option th:each="cat : ${categories}"
                        th:value="${cat.categoryId}"
                        th:text="${cat.categoryName}"
                        th:selected="${cat.categoryId != null && cat.categoryId.equals(selectedCategoryId)}">
                </option>
            </select>

            <input type="text" name="productName" placeholder="Tìm sản phẩm..." th:value="${searchKey}">
            <button type="submit" class="btn">Tìm kiếm</button>
            <a th:href="@{/products}" class="btn" style="background-color: #6c757d;">Reset</a>
        </form>
    </div>

    <a href="/products/form" class="btn" sec:authorize="hasRole('ADMIN')">+ Thêm sản phẩm mới</a>

    <div class="product-grid">

        <div class="product-card" th:each="p : ${products}">
            <div class="product-card-content">
                <img th:src="@{${p.imageUrl}}" alt="Ảnh sản phẩm">
                <h4 class="product-name" th:text="${p.productName}">Tên sản phẩm</h4>
                <p class="product-price" th:text="${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">100.000 đ</p>
                <p class="product-description" th:text="${p.description}">Mô tả ngắn gọn về sản phẩm...</p>
                <span class="product-category" th:text="${p.categoryName}">Danh mục</span>
            </div>
            
            <div class="product-card-actions">
                <a th:href="@{'/products/id/' + ${p.productId}}" class="btn">Chi tiết</a>
                
                <form sec:authorize="hasRole('ADMIN')" th:action="@{'/products/delete/' + ${p.productId}}"
                      method="post"
                      style="display:inline;">
                    <button type="submit" class="btn" style="background:red;">Xóa</button>
                </form>
            </div>
        </div>

        <div class="no-products-message" th:if="${products == null or products.isEmpty()}">
            Không tìm thấy sản phẩm nào.
        </div>

    </div>
    
    <div class="pagination" th:if="${totalPages > 0}">
        <a th:each="i : ${#numbers.sequence(0, totalPages-1)}"
        th:classappend="${i} == ${currentPage} ? 'active'"
        th:href="@{/products(page=${i}, categoryId=${selectedCategoryId}, productName=${searchKey})}"
        th:text="${i + 1}">1</a>
    </div>

</div>

<script>
    document.addEventListener("click", function(e) {
        // Script vẫn hoạt động vì nó tìm nút dựa trên style
        if (e.target.matches(".btn[style*='red']")) {
            if (!confirm("Bạn có chắc muốn xóa sản phẩm này?")) {
                e.preventDefault();
            }
        }
    });
</script>
<img style="width:100%;" src="image/banner/banner_product_2.webp">

<!-- Footer -->
  <section class="contact_container">
    <div class="logo2" style="color:white">
      <h1>LYN</h1>
    </div>
    <div class="contact">
      <div class="fb-in">
        <h6>FOLLOW US</h6>
        <a href="https://web.facebook.com/le.duy.hungg.2025" target="_blank"><i class='bx bxl-facebook-circle'></i></a>
        <a href="https://www.instagram.com/ldhung_1401/" target="_blank"><i class='bx bxl-instagram'></i></a>
        <a href="https://www.youtube.com/@duyhung8919" target="_blank"><i class='bx bxl-youtube'></i></a>
        <a><i class='bx bxl-twitter'></i></a>
        <a><i class='bx bxl-tiktok'></i></a>
      </div>

      <div class="mail">
        <h6>CONTACT</h6>
        <p><i class='bx bx-envelope'></i> hungleduy278@gmail.com</p>
        <p><i class='bx bx-phone-call'></i> 0917947492</p>
      </div>

      <div class="support">
        <h6>SUPPORT</h6>
        <p>Cách thức mua hàng</p>
        <p>Chính sách bảo mật</p>
        <p>Chính sách bảo hành và đổi trả</p>
      </div>
    </div>
  </section>
<!-- /Footer -->
</body>

</html>
