<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Chi ti·∫øt ƒë∆°n h√†ng</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      padding: 30px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h2 { color: #007bff; }
    .info { margin-bottom: 20px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th { background: #007bff; color: white; }
    .btn {
      display: inline-block;
      padding: 8px 16px;
      background: #007bff;
      color: white;
      border-radius: 5px;
      text-decoration: none;
    }
    .btn:hover { background: #0056b3; }
    .btn-danger { background: #dc3545; }
  </style>
  <script>
    function confirmCancel(orderId, userId) {
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?")) {
        document.getElementById("cancelForm").submit();
      }
    }
  </script>
</head>
<body>
<div class="container">
    <h2>Chi ti·∫øt ƒë∆°n h√†ng #<span th:text="${order.orderId}"></span></h2>
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <div class="info">
        <p><strong>Ng√†y t·∫°o:</strong> <span th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}"></span></p> <p><strong>Tr·∫°ng th√°i:</strong> <span th:text="${order.status}"></span></p>
        <p><strong>ƒê·ªãa ch·ªâ giao h√†ng:</strong> <span th:text="${order.shippingAddress}"></span></p>
    </div>

    <h3>S·∫£n ph·∫©m trong ƒë∆°n h√†ng</h3>
    <table>
        <thead>
        <tr>
            <th>·∫¢nh</th> <th>T√™n s·∫£n ph·∫©m</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Gi√°</th>
            <th>T·ªïng</th>
            <th>H√†nh ƒë·ªông</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${order.orderItems}">
            <td>
                <img th:if="${item.product.imageUrl}"
                     th:src="@{${item.product.imageUrl}}"
                     alt="·∫¢nh s·∫£n ph·∫©m"
                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
            </td>
            <td>
                <a th:href="@{'/products/id/' + ${item.product.productId}(origin='order', orderId=${order.orderId})}"
                   th:text="${item.product.productName}"
                   style="text-decoration: none; color: #007bff; font-weight: 500;">
                </a>
            </td>
            <td th:text="${item.quantity}"></td>
            <td th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td> <td th:text="${#numbers.formatDecimal(item.subTotal, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td> <td>
                <form th:action="@{'/orders/' + ${order.orderId} + '/items/' + ${item.orderItemId} + '/delete'}"
                      method="post"
                      onsubmit="return confirm('X√≥a s·∫£n ph·∫©m n√†y kh·ªèi ƒë∆°n h√†ng?');"
                      style="display: inline;">
                    <button type="submit" class="btn btn-danger" style="padding: 4px 8px; font-size: 12px;">X√≥a</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <p><strong>T·ªïng ti·ªÅn:</strong> <span th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></span></p>

    <form id="cancelForm" th:if="${order.status.name() == 'PENDING'}"
          th:action="@{'/orders/' + ${order.orderId} + '/cancel'}" method="post" style="display: inline;">
        <button type="button" class="btn btn-danger" onclick="confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?') ? this.form.submit() : false;">H·ªßy ƒë∆°n</button>
    </form>
    <a th:if="${order.status.name() == 'PENDING'}"
       th:href="@{'/payments/order/' + ${order.orderId}}"
       class="btn"
       style="background-color: #28a745; margin-left: 10px;">
        üí≥ Thanh to√°n
    </a>
    <a class="btn" th:href="@{/orders/my-orders}">‚¨Ö Quay l·∫°i danh s√°ch</a>
</div>
</body>
</html>
